<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Radiation scatter</title>

<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">

<style>

body{
  background:#e6ded9;
  font-family:"GT America Mono","Space Mono",monospace;
  display:flex;
  justify-content:center;
  margin-top:40px;
}

svg{
  width:600px;
  height:490px;
}

/* axes */
.axis text{
  font-size:11px;
  fill:#2b2b2b;
}
.axis path,.axis line{
  stroke:#b8aea8;
}

/* grid */
.grid line{
  stroke:#d6ccc6;
  stroke-dasharray:2 2;
}
.grid path{
  display:none;
}

/* tooltip */
#tooltip{
  position:absolute;
  background:#1c1c1c;
  color:white;
  font-size:11px;
  padding:6px 8px;
  pointer-events:none;
  opacity:0;
  border-radius:3px;
}

</style>
</head>

<body>

<div id="tooltip"></div>
<svg width="600" height="490"></svg>

<script src="https://d3js.org/d3.v7.min.js"></script>

<script>

const width = 600;
const height = 490;

const margin = {top:60,right:40,bottom:60,left:70};
const innerW = width-margin.left-margin.right;
const innerH = height-margin.top-margin.bottom;

const colors = {
  severe:"#d65c7a",
  risk:"#d89b3c",
  low:"#4fa7b5"
};

const svg = d3.select("svg");
const g = svg.append("g")
  .attr("transform",`translate(${margin.left},${margin.top})`);

const tooltip = d3.select("#tooltip");

d3.csv("data.csv").then(data=>{

  data.forEach(d=>{
    d.daily_msv = +d.daily_msv;
    d.cumulative_msv = +d.cumulative_msv;
  });

  const x = d3.scaleLog()
    .domain([1, d3.max(data,d=>d.cumulative_msv)])
    .range([0,innerW]);

  const y = d3.scaleLog()
    .domain([0.01, d3.max(data,d=>d.daily_msv)])
    .range([innerH,0]);

  // grid
  g.append("g")
    .attr("class","grid")
    .attr("transform",`translate(0,${innerH})`)
    .call(d3.axisBottom(x).ticks(6).tickSize(-innerH).tickFormat(""));

  g.append("g")
    .attr("class","grid")
    .call(d3.axisLeft(y).ticks(6).tickSize(-innerW).tickFormat(""));

  // axes
  g.append("g")
    .attr("class","axis")
    .attr("transform",`translate(0,${innerH})`)
    .call(d3.axisBottom(x).ticks(6,"~s"));

  g.append("g")
    .attr("class","axis")
    .call(d3.axisLeft(y).ticks(6,"~s"));

  const diamond = d3.symbol()
    .type(d3.symbolDiamond)
    .size(120);

  g.selectAll(".pt")
    .data(data)
    .enter()
    .append("path")
    .attr("class","pt")
    .attr("d",diamond)
    .attr("transform",d=>`translate(${x(d.cumulative_msv)},${y(d.daily_msv)})`)
    .attr("fill",d=>colors[d.category])
    .attr("stroke","#3b2f2a")

    .on("mouseover", function(event,d){
      tooltip
        .style("opacity",1)
        .html(d.label);
    })

    .on("mousemove", function(event){
      tooltip
        .style("left",(event.pageX+12)+"px")
        .style("top",(event.pageY-10)+"px");
    })

    .on("mouseout", function(){
      tooltip.style("opacity",0);
    });

});

</script>
</body>
</html>
